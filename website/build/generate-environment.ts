import * as fs from 'fs';
import * as path from 'path';

import type {Environment} from '../src/environments/environment.interface';
import {getHeadHash} from './env.util';

const gitHead = getHeadHash();

const generatedEnvironment: Partial<Environment> = {
    release: gitHead,
};

const generatedFile = `\
/* eslint-disable */

// This file is automatically generated by generate-environment.ts using yarn run build:env:pre. It
// is used to inject the release into the production environment. It is recommended to ignore this
// file using git update-index --skip-worktree src/environments/environment.generated.ts
export const generatedEnvironment = ${JSON.stringify(generatedEnvironment, undefined, 4)};
`;

fs.writeFileSync(
    path.join(__dirname, '..', 'src', 'environments', 'environment.generated.ts'),
    generatedFile,
);
